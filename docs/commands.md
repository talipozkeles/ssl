################################################################################
# Generate a chain of certificates

# Generates a key pair (a public key and associated private key). Wraps the public key into an X.509 v3 self-signed certificate, which is stored as a single-element certificate chain. This certificate chain and the private key are stored in a new keystore entry identified by alias.
keytool -genkeypair -keystore root.jks -alias root -storepass changeit -ext bc:c -dname "CN=root" <<< '\n'
keytool -genkeypair -keystore ca.jks -alias ca -storepass changeit -ext bc:c -dname "CN=ca" <<< '\n'
keytool -genkeypair -keystore server.jks -alias server -storepass changeit -dname "cn=server" <<< '\n'

# Reads from the keystore the certificate associated with alias and stores it in the file. When no file is specified, the certificate is output to stdout.
keytool -keystore root.jks -alias root -exportcert -rfc -storepass changeit > root.pem

# Generates a Certificate Signing Request (CSR) using the PKCS #10 format.
keytool -storepass changeit -keystore ca.jks -certreq -alias ca > ca.csr

# Generates a certificate as a response to a certificate request file (which can be created by the keytool -certreq command).
keytool -storepass changeit -keystore root.jks -gencert -alias root -ext BC=0 -rfc -infile ca.csr > ca.pem

# Generates a Certificate Signing Request (CSR) using the PKCS #10 format.
keytool -storepass changeit -keystore server.jks -certreq -alias server > server.csr

# Generates a certificate as a response to a certificate request file (which can be created by the keytool -certreq command).
keytool -storepass changeit -keystore ca.jks -gencert -alias ca -ext ku:c=dig,keyEncipherment -rfc -infile server.csr > server.pem

# Reads the certificate or certificate chain (where the latter is supplied in a PKCS#7 formatted reply or a sequence of X.509 certificates) from the file, and stores it in the keystore entry identified by alias. Which type of import is intended is indicated by the value of the -alias option. If the alias does not point to a key entry, then the keytool command assumes you are adding a trusted certificate entry. In this case, the alias should not already exist in the keystore. If the alias does already exist, then the keytool command outputs an error because there is already a trusted certificate for that alias, and does not import the certificate. If the alias points to a key entry, then the keytool command assumes you are importing a certificate reply.
cat root.pem ca.pem server.pem | keytool -keystore server.jks -storepass changeit -importcert -alias server -noprompt

# Now server.jks contains the chain of certificates

################################################################################
# Inspect the contents of the files

# Prints the content of a PKCS #10 format certificate request, which can be generated by the keytool -certreq command.
keytool -printcertreq -file server.csr

# Reads the certificate from the file, the SSL server located at host:port, or the signed JAR file JAR_file (with the -jarfile option and prints its contents in a human-readable format.
keytool -printcert -v -file server.pem

# Prints to stdout the contents of the keystore entry identified by alias. If no alias is specified, then the contents of the entire keystore are printed.
keytool -list -v -storepass changeit -keystore server.jks
